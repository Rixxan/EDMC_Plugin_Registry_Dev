name: Build Plugin File
on:
  push:
    branches: [ master ]
  schedule:
    - cron: '38 5 * * 4'
  workflow_dispatch:

jobs:
  build_file:
    name: build unified plugin file
    runs-on: ubuntu-latest
    steps:
      - name: Check out the repo
        uses: actions/checkout@v6
      - name: setup python
        uses: actions/setup-python@v6
        with:
          python-version: 3.13
      - name: Run script
        uses: jannekem/run-python-script-action@v1
        with:
          script: |
            import os
            import json

            plugins_dir = "plugins"
            output_file = "master_plugin_list.json"

            plugins = []

            for entry in sorted(os.scandir(plugins_dir), key=lambda e: e.name):
                if entry.is_file() and entry.name.lower().endswith(".json"):
                    with open(entry.path, "r", encoding="utf-8") as f:
                        plugins.append(json.load(f))

            with open(output_file, "w", encoding="utf-8") as out:
                json.dump(plugins, out, indent=2, ensure_ascii=False)

            print(f"Wrote {len(plugins)} plugins to {output_file}")
      - name: push file to main
        uses: EndBug/add-and-commit@v9
        with:
          add: 'master_plugin_list.json'
          default_author: github_actor
          message: 'Update unified plugin file'
          push: true
